---
title: "[WSL] WSL에 CUDA, TF 설치"
date: 2023-04-14

categories: TIL
tags:
  - WSL
  - CUDA
  - Tensorflow
---

# WSL에 CUDA, TF 설치
### WSL 초기 설정

```bash
// WSL 업데이트
wsl.exe --update
// WSL 재시작
wsl --shutdown
wsl
// GPG Key 삭제
wsl$ sudo apt-key del 7fa2af80
```

### WSL-Ubuntu용 CUDA Toolkit 설치
[CUDA Download](https://developer.nvidia.com/cuda-downloads)
- deb (local)
- 원하는 버전 설치

```bash
// CUDA Toolkit 11.8
$ wget https://developer.download.nvidia.com/compute/cuda/repos/wsl-ubuntu/x86_64/cuda-wsl-ubuntu.pin
$ sudo mv cuda-wsl-ubuntu.pin /etc/apt/preferences.d/cuda-repository-pin-600
$ wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda-repo-wsl-ubuntu-11-8-local_11.8.0-1_amd64.deb
$ sudo dpkg -i cuda-repo-wsl-ubuntu-11-8-local_11.8.0-1_amd64.deb
$ sudo cp /var/cuda-repo-wsl-ubuntu-11-8-local/cuda-*-keyring.gpg /usr/share/keyrings/
$ sudo apt-get update
$ sudo apt-get -y install cuda
```
### cuDNN 설치
[cuDNN Download](https://developer.nvidia.com/cudnn)

```bash
// 로컬 다운로드 파일로 이동
$ cd/mnt/c/Users/~~~~/Downloads
// 압축해제
$ tar xvf cudnn-linux~~~~~
// 파일 복사
$ sudo cp cudnn-*-archive/include/cudnn-*.h /usr/local/cuda/include
$ sudo cp -P cudnn-*-archive/lib/libcudnn* /usr/local/cuda/lib64
$ sudo chmod a+r /usr/local/cuda/include/cudnn*.h /usr/local/cuda/lib64/libcudnn*
```

### .bashrc 환경변수 추가

```bash
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:usr/local/cuda-설처버전/lib64/
// 저장 후 나오기

// 변경사항 반영
$ source ~/.bashrc

// 정상 설치 확인
$ /usr/local/cuda-설치버전/extras/demo_suite/deviceQuery
```

### Tensorflow 설치

```bash
$ conda install -c conda-forge cudatoolkit=11.8.0
$ python3 -m pip install nvidia-cudnn-cu11==8.6.0.163 tensorflow==2.12.*
$ mkdir -p $CONDA_PREFIX/etc/conda/activate.d
$ echo 'CUDNN_PATH=$(dirname $(python -c "import nvidia.cudnn;print(nvidia.cudnn.__file__)"))' >> $CONDA_PREFIX/etc/conda/activate.d/env_vars.sh
$ echo 'export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CONDA_PREFIX/lib/:$CUDNN_PATH/lib' >> $CONDA_PREFIX/etc/conda/activate.d/env_vars.sh
$ source $CONDA_PREFIX/etc/conda/activate.d/env_vars.sh
$ python3 -c "import tensorflow as tf; print(tf.config.list_physical_devices('GPU'))"
```

`numa` 관련 에러? 경고?가 발생하는데 사용하는데는 크게 문제 없는거 같다.  
단순 안내라는 말이 많던데 출력되는게 보기 싫어서 없애고 싶은데 마땅한 해결법을 아직 찾지 못했다.
